<?php
 include 'config.php';
 session_start();
 
 // Verificar se o usuário está logado
 if (!isset($_SESSION['user_id'])) {
     // Redirecionar para a página de login se não estiver logado
     header("Location: index.php");
     exit();
 }
 
 // Obter o ID do usuário da sessão
 $user_id = $_SESSION['user_id'];
 
 // Consultar o banco de dados para obter os dados do usuário
 $query = "SELECT * FROM users WHERE id = '$user_id'";
 $result = mysqli_query($conn, $query);
 
 if ($result && mysqli_num_rows($result) > 0) {
     $user = mysqli_fetch_assoc($result);
     $name = $user['nome'];
     $photo = $user['foto'];
 } else {
     // Redirecionar para a página de login se não for possível obter os dados do usuário
     header("Location: index.php");
     exit();
 }
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="img/logo/logo.png" type="image/x-icon">
    <title>VEchat</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="bootstrap-icons/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Tilt+Neon&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style2.css">
    <link rel="stylesheet" href="css/elements.css">

    <link rel='stylesheet' type='text/css' media='screen' href='css/main.css'>
    <link rel='stylesheet' type='text/css' media='screen' href='css/room.css'>
    <style>
        .video_container{
            background-image: url('img/logo/logo.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 80px;
        }
    </style>
    
</head>
<body>

    <div class="container_father">

        <div class="color"></div>
        <div class="color"></div>
        <div class="color"></div>

        <div class="main">

            <div class="sidebar">
                <div class="logo">VE</div>
                  <div class="icons">
                    <i class="bi bi-person-fill" id="menu-btn"></i>
                    <i class="bi bi-bell-fill"></i>
                    <i class="bi bi-house-fill active"></i>
                    <i class="bi bi bi-send-fill" onclick="redirectToPage()"></i>
                    <i class="bi bi-chat-fill"></i>
                  </div>
                  <div class="icons"><a href="logout.php" style="text-decoration: none;"><i class="bi bi-door-open-fill"></i></a></div>
            </div>

            <div class="content">
                <nav>
                    <div class="perfil">
                        <div><img src="<?php echo $photo; ?>" alt="user photograph"></div>
                        <p><span><?php echo $name; ?></span></p>
                    </div>
                </nav>
                <div class="main_content">
                    <div class="item3" id="teste">
                        <div id="member__list">
                            <div id="room__container">
                                <section id="members__container">

                                    <div id="members__header">
                                        <p>Participants</p>
                                        <strong id="members__count">0</strong>
                                    </div>

                            <div class="member__wrapper" id="member__1__wrapper" style="margin-top: 40px;">
                                <!--<span class="green__icon"></span>-->
                                <p class="member_name"></p>
                            </div>
            
                        </section>
                    </div>
                        </div>
                    </div>
                    <div class="item1" id="teste1">
                        <div class="videocall" id="stream__container">

                            <div id="stream_box"></div>

                            <div id="streams_container">
                                <!--<div class="video_container" id="user-container-1">
                                    <h1>1</h1>
                                </div>-->
                            </div>
                            <footer>
                                <div class="vol">
                                    <i class="bi bi-volume-up-fill"></i>
                                </div>
                                <div class="main_icons">
                                    <span class="icon"><i class="bi bi-back active"  id="screen-btn"></i></span>
                                    <span class="icon"><i class="bi bi-mic-mute-fill active" id="mic-btn"></i></span>
                                    <span class="icon"><i class="bi bi-telephone-fill" id="leave-btn"></i></span>
                                    <span class="icon" id="part"><i class="bi bi-camera-video-off-fill active" id="camera-btn"></i></span>
                                    <span class="icon"><i class="bi bi-eye-fill active" id="join-btn"></i></span>
                                </div>
                                <div class="extra">
                                    <i class="bi bi-gear-fill"></i>
                                </div>
                            </footer>
                        </div>
                    </div>
                    <div class="item2">

                        <div class="message">
                            <main>
                                <div id="room__container">

                            <section id="messages__container">

                                <div id="messages">
                
                                    <form id="message__form">
                                        <input type="text" name="message" placeholder="Send a message...." />
                                    </form>
                                </div>
                            </section>
                        </div>
                       </div>
                      </main>
                    </div>
                </div>
            </div>

        </div>

    </div>


<script src="js/sidebar.js"></script>
<script type="text/javascript" src="js/AgoraRTC_N-4.17.2.js"></script>
<script type="text/javascript" src="js/agora-rtm-sdk-1.5.1.js"></script>
<script type="text/javascript" src="js/room.js"></script>
<script type="text/javascript" src="js/room_rtm.js"></script>
<script type="text/javascript" src="js/room_rtc.js"></script>
<script>function redirectToPage() {window.location.href = "lobby.php";}
</script>
</body>
</html>